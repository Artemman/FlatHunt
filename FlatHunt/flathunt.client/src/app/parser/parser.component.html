<mat-card class="parser-card">
  <mat-card-title>Parser / Sync</mat-card-title>

  <form [formGroup]="form" class="parser-form" (ngSubmit)="$event.preventDefault()">
    <div class="fields-row">
      <mat-form-field appearance="outline">
        <mat-label>Source</mat-label>
        <mat-select formControlName="source">
          <mat-option *ngFor="let s of sources" [value]="s.value">{{ s.label }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>City</mat-label>
        <mat-select formControlName="cityId">
          <mat-option *ngFor="let c of cities" [value]="c.id">{{ c.name }}</mat-option>
        </mat-select>
        <mat-progress-spinner *ngIf="citiesLoading" diameter="20" mode="indeterminate" class="cities-spinner"></mat-progress-spinner>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Rooms</mat-label>
        <input matInput type="number" formControlName="roomCount" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>From</mat-label>
        <input matInput [matDatepicker]="fromPicker" formControlName="createdFrom" />
        <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
        <mat-datepicker #fromPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>To</mat-label>
        <input matInput [matDatepicker]="toPicker" formControlName="createdTo" />
        <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
        <mat-datepicker #toPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <div class="actions-row">
      <button mat-stroked-button type="button" (click)="clear()" [disabled]="running">
        <mat-icon>clear</mat-icon>
        Clear
      </button>

      <div class="spacer"></div>

      <button mat-flat-button color="primary" type="button" (click)="startParsing()" [disabled]="running">
        <mat-icon *ngIf="!running">play_arrow</mat-icon>
        <mat-progress-spinner *ngIf="running" mode="indeterminate" diameter="20"></mat-progress-spinner>
        <span class="btn-text">{{ running ? 'Parsingâ€¦' : 'Start parsing' }}</span>
      </button>
    </div>
  </form>

  <mat-divider></mat-divider>

   <mat-card *ngIf="!running && lastCount != null" class="result-summary">
      <mat-card-content>
        <div class="summary-row">
          <div><strong>Items parsed:</strong> {{ lastCount }}</div>
          <div *ngIf="lastRun"><strong>Last run:</strong> {{ lastRun | date:'short' }}</div>
        </div>
      </mat-card-content>
    </mat-card>
</mat-card>
